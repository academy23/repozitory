<?php	function addSubject(){//форма додавання країни		$faculty = '<option value=""></option>';		$lector = '<option value=""></option>';		$query="SELECT * FROM faculties";		$res=mysql_query($query);		while($row=mysql_fetch_array($res)){			$faculty .= "<option value=".$row['id'].">".$row['title_faculty']."</option>";		}		$query="SELECT * FROM lectors";		$res=mysql_query($query);		while($row=mysql_fetch_array($res)){			$lector .= "<option value=".$row['id'].">".$row['surname']." ".$row['firstname']."</option>";		}		$GLOBALS['h1'] = "Додавання нового предмету";		$GLOBALS['content'] = <<<HTML		<div class="row-fluid">			<div class="span6">				<form class="well form-inline" method="POST" action="/?action=addSubjectDo">					<div class="row-fluid">						<label>Назва предмету</label>						<input type="text" name="title_subject" class="span12" value=""/>					</div>					<div class="row-fluid">						<label>Факультет</label>						<select name="id_faculty" class="span12">							{$faculty}						</select>					</div>					<div class="row-fluid">						<label>Номер семестру</label>						<input type="text" name="number_of_semestr" class="span12" value=""/>					</div>					<div class="row-fluid">						<label>Форма контролю</label>						<select name="form_control" class="span12">							<option value="1">Залік</option>							<option value="2">Екзамен</option>						</select>					</div>					<div class="row-fluid">						<label>Лектор</label>						<select name="id_lector" class="span12">							{$lector}						</select>					</div>					<div class="row-fluid">						<button type="submit" class="btn">Додати</button>					</div>				</form>			</div>		</div>HTML;	}		function addSubjectDo(){//додавання країни		$title_subject = $_POST['title_subject'];		$id_faculty = $_POST['id_faculty'];		$number_of_semestr = $_POST['number_of_semestr'];		$id_form_control = $_POST['form_control'];		$id_lector = $_POST['id_lector'];		$query = 'INSERT INTO subjects (title_subject, id_faculty, number_of_semestr, form_control, id_lector) VALUES ("'.$title_subject.'", "'.$id_faculty.'", "'.$number_of_semestr.'", "'.$id_form_control.'", "'.$id_lector.'")';		$result = mysql_query($query) or die(mysql_error());		header('Location: /?action=listSubject', true, 303);	}		function listSubject(){		if(isset($_GET['filter'])){			switch ($_GET['filter']){				case 'search':					$filter = "WHERE title_subject LIKE '%{$_GET['query']}%'";					break;				//case 'title_faculty':					//$filter = 'ORDER BY title_faculty '.$_GET['order'];					//break;				//case 'year_foundation':					//$filter = 'ORDER BY year_foundation '.$_GET['order'];					//break;								default: $filter = '';					break;			}		}else{			$filter = "";		}		$GLOBALS['h1'] = "Предмети";		$GLOBALS['content'] = '';		$GLOBALS['content'] .= <<<TPL		<div class="row-fluid"><a href="/?action=addSubject" class="btn btn-info right">Добавити предмет</a></div>		<div class="row-fluid">			<table class="table table-bordered" id="dt_gal">				<thead>					<tr style="text-align:center;">						<th>№</th>						<th>Назва предмету</th>						<th>Факультет</th>						<th>Номер семестру</th>						<th>Форма контролю</th>						<th>Лектор</th>						<th></th>					</tr>				</thead>			<tbody>TPL;		$query="SELECT 					subjects.id as id_subject,					subjects.title_subject,					subjects.id_faculty,					subjects.number_of_semestr,					subjects.form_control,					subjects.id_lector,					faculties.id,					faculties.title_faculty,					lectors.id,					lectors.firstname,					lectors.surname				FROM 					subjects				LEFT JOIN faculties ON subjects.id_faculty=faculties.id				LEFT JOIN lectors ON subjects.id_lector=lectors.id				{$filter}";							$res=mysql_query($query);		$i = 0;		while($row=mysql_fetch_array($res)){			if($row['form_control']==1){				$form_control = 'Залік';			}else{				$form_control = 'Екзамен';			}			$i = $i+1;			$GLOBALS['content'] .= "				<tr>					<td>".$i."</td>					<td>".$row['title_subject']."</td>					<td>".$row['title_faculty']."</td>					<td>".$row['number_of_semestr']."</td>					<td>".$form_control."</td>					<td>".$row['surname']." ".$row['firstname']."</td>					<td><a title='Змінити' href='/?action=editSubject&id=".$row['id_subject']."'><i class='icon-pencil'></i></a><a title='Видалити' class='confirm del' href='/?action=deleteSubjectDo&id=".$row['id_subject']."'><i class='icon-trash'></i></a></td>				<tr/>";		}		$GLOBALS['content'] .= '</tbody></table></div>';	}		function deleteSubjectDo(){//видалення юзера		$strSQL = ("DELETE FROM subjects WHERE id='{$_GET['id']}' LIMIT 1");		mysql_query($strSQL);		header('Location: /?action=listSubject', true, 303);	}		function editSubject(){		$faculty = '<option value=""></option>';		$lector = '<option value=""></option>';		$query="SELECT * FROM faculties";		$res=mysql_query($query);		while($row=mysql_fetch_array($res)){			$faculty .= "<option value=\"".$row['id']."\">".$row['title_faculty']."</option>";		}		$query="SELECT * FROM lectors";		$res=mysql_query($query);		while($row=mysql_fetch_array($res)){			$lector .= "<option value=\"".$row['id']."\">".$row['surname']." ".$row['firstname']."</option>";		}				$query="SELECT * FROM subjects WHERE id = '{$_GET['id']}'";		$res=mysql_query($query);		$row=mysql_fetch_array($res);		$id = $row['id'];					$text_form_control = '<option value="1">Залік</option><option value="2">Екзамен</option>';				$var = 'value="'.$row['form_control'].'"';		$chose_form_control = select($text_form_control,$var);				if($row['id_lector']!=0){		$var_lector = 'value="'.$row['id_lector'].'"';		$chose_lector = select($lector, $var_lector);		}else{			$chose_lector = $lector;		}				if($row['id_faculty']!=0){		$var_faculty = 'value="'.$row['id_faculty'].'"';		$chose_faculty = select($faculty, $var_faculty);		}else{			$chose_faculty = $faculty;		}		$GLOBALS['h1'] = "Редагування предмету";		$GLOBALS['content'] = <<<HTML		<div class="row-fluid">			<div class="span6">				<form class="well form-inline" method="POST" action="/?action=editSubjectDo">					<div class="row-fluid">						<label>Назва предмету</label>						<input type="text" name="title_subject" class="span12" value="{$row['title_subject']}"/>					</div>					<div class="row-fluid">						<label>Факультет</label>						<select name="id_faculty" class="span12">							{$chose_faculty}						</select>					</div>					<div class="row-fluid">						<label>Номер семестру</label>						<input type="text" name="number_of_semestr" class="span12" value="{$row['number_of_semestr']}"/>					</div>					<div class="row-fluid">						<label>Форма контролю</label>						<select name="form_control" class="span12">							{$chose_form_control}						</select>					</div>					<div class="row-fluid">						<label>Лектор</label>						<select name="id_lector" class="span12">							{$chose_lector}						</select>					</div>					<div class="row-fluid">						<button type="submit" class="btn">Змінити</button>						<input type="hidden" name="id" value="{$id}"/>					</div>				</form>			</div>		</div>HTML;		}		function editSubjectDo(){//редагування юзера		$strSQL = 'UPDATE subjects SET title_subject = "'.$_POST["title_subject"].'", id_faculty = "'.$_POST["id_faculty"].'", number_of_semestr = "'.$_POST["number_of_semestr"].'", form_control = "'.$_POST["form_control"].'", id_lector = "'.$_POST["id_lector"].'" WHERE id = "'.$_POST['id'].'"';		mysql_query($strSQL);		header('Location: /?action=listSubject', true, 303);	}?>