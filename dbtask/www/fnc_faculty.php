<?php	function addFaculty(){		$countries = '<option value=""></option>';		$query="SELECT * FROM countries";		$res=mysql_query($query);		while($row=mysql_fetch_array($res)){			$countries .= "<option value=".$row['id'].">".$row['country']."</option>";		}		$decans = '<option value="0"></option>';		$query="SELECT * FROM lectors";		$res=mysql_query($query);		while($row=mysql_fetch_array($res)){			$decans .= "<option value=".$row['id'].">".$row['surname']." ".$row['firstname']."</option>";		}		$GLOBALS['h1'] = "Додавання нового факультету";		$GLOBALS['content'] = <<<HTML		<div class="row-fluid">			<div class="span6">				<form class="well form-inline" method="POST" action="/?action=addFacultyDo">					<div class="row-fluid">						<label>Назва факультету</label>						<input type="text" name="faculty" class="span12" value=""/>					</div>					<div class="row-fluid">						Якщо немає потрібної країни, просто додайте її при редагуванні<br/>						<label>Країна</label>						<select name="country" class="span12">							{$countries}						</select>					</div>					<div class="row-fluid">						<label>Місто</label>						<input type="text" name="city" class="span12" value=""/>					</div>					<div class="row-fluid">						<label>Вулиця</label>						<input type="text" name="street" class="span12" value=""/>					</div>					<div class="row-fluid">						<label>Будинок</label>						<input type="text" name="house" class="span12" value=""/>					</div>					<div class="row-fluid">						<label>Поштовий індекс</label>						<input type="text" name="zip_code" class="span12" value=""/>					</div>					<div class="row-fluid">						<label>Рік заснування</label>						<input type="text" name="year_foundation" class="span12" value=""/>					</div>					<div class="row-fluid">						Якщо немає потрібного декана, пропустіть і нічого не додавайте, а потім додайте лектора і змініть декана при редагуванні<br/>						<label>Декан</label>						<select name="decan" class="span12">							{$decans}						</select>					</div>					<div class="row-fluid">						<button type="submit" class="btn">Додати</button>					</div>				</form>			</div>		</div>HTML;	}		function addFacultyDo(){		$faculty = $_POST['faculty'];		$country = $_POST['country'];		$city = $_POST['city'];		$street = $_POST['street'];		$house = $_POST['house'];		$zip_code = $_POST['zip_code'];		$year_of_foundation = $_POST['year_foundation'];		$decan = $_POST['decan'];		$query = 'INSERT INTO addresses (country_id, city, street, house, zip_code) VALUES ("'.$country.'", "'.$city.'", "'.$street.'", "'.$house.'", "'.$zip_code.'")';		$result = mysql_query($query) or die(mysql_error());		$id_address = mysql_insert_id();		$query_faculty = 'INSERT INTO faculties (title_faculty, id_address, year_foundation, id_decan) VALUES ("'.$faculty.'", "'.$id_address.'", "'.$year_of_foundation.'", "'.$decan.'")';		$result_faculty = mysql_query($query_faculty) or die(mysql_error());		header('Location: /?action=listFaculty', true, 303);	}		function listFaculty(){			if(isset($_GET['filter'])){			switch ($_GET['filter']){				case 'search':					$filter = "WHERE title_faculty LIKE '%{$_GET['query']}%'";					break;				case 'title_faculty':					$filter = 'ORDER BY title_faculty '.$_GET['order'];					break;				case 'year_foundation':					$filter = 'ORDER BY year_foundation '.$_GET['order'];					break;								default: $filter = '';					break;			}		}else{			$filter = "";		}		$GLOBALS['h1'] = "Факультети";		$GLOBALS['content'] = '';		$GLOBALS['content'] .= <<<TPL		<div class="row-fluid"><a href="/?action=addFaculty" class="btn btn-info right">Додати факультет</a></div>		<div class="row-fluid">			<table class="table table-bordered" id="dt_gal">				<thead>					<tr style="text-align:center;">						<th>№</th>						<th>Назва факультету <a href="/?action=listFaculty&filter=title_faculty&order=ASC"><i class='icon-arrow-up'></i></a><a href="/?action=listFaculty&filter=title_faculty&order=DESC"><i class='icon-arrow-down'></i></a></th>						<th>Адреса</th>						<th>Рік заснування <a href="/?action=listFaculty&filter=year_foundation&order=ASC"><i class='icon-arrow-up'></i></a><a href="/?action=listFaculty&filter=year_foundation&order=DESC"><i class='icon-arrow-down'></i></a></th>						<th>Декан</th>						<th></th>						<th>Предмети, <br/>що читаються на факультеті</th>						<th>Викладачі, <br/>які працюють на факультеті</th>					</tr>				</thead>			<tbody>TPL;		$query ="SELECT					faculties.id as id_faculty, 					faculties.id_address, 					faculties.title_faculty, 					faculties.year_foundation, 					faculties.id_decan,					lectors.id,					lectors.surname,					lectors.firstname,					addresses.city,					addresses.street,					addresses.house,					addresses.zip_code,					addresses.country_id,					countries.id,					countries.country				FROM 					faculties				LEFT JOIN lectors ON faculties.id_decan=lectors.id				LEFT JOIN addresses ON faculties.id_address=addresses.id				LEFT JOIN countries ON addresses.country_id=countries.id				{$filter}";				$res=mysql_query($query);		$i = 0;		while($row=mysql_fetch_array($res)){			$i = $i+1;			$GLOBALS['content'] .= "				<tr>					<td>".$i."</td>					<td>".$row['title_faculty']."</td>					<td>".$row['country'].", ".$row['city'].", ".$row['street'].", ".$row['house'].".<br/>Поштовий індекс: ".$row['zip_code']."</td>					<td>".$row['year_foundation']."</td>					<td>".$row['surname']." ".$row['firstname']."</td>					<td><a title='Редактировать' href='/?action=editFaculty&id=".$row['id_faculty']."'><i class='icon-pencil'></i></a></td>					<td><a title='Предмети' href='/?action=subjectOfFaculty&id=".$row['id_faculty']."'><i class='icon-th-large'></i></a></td>					<td><a title='Предмети' href='/?action=lectorOfFaculty&id=".$row['id_faculty']."'><i class='icon-home'></i></a></td>				<tr/>";		}		$GLOBALS['content'] .= '</tbody></table></div>';	}		function editFaculty(){//форма редагування юзера		$decan = '<option value=""></option>';		$query_decan="SELECT * FROM lectors WHERE id_faculty_work = '{$_GET['id']}'";		$res_decan=mysql_query($query_decan);		while($row_decan=mysql_fetch_array($res_decan)){			$decan .= "<option value=".$row_decan['id'].">".$row_decan['surname']." ".$row_decan['firstname']."</option>";		}		$query="SELECT * FROM faculties WHERE id = '{$_GET['id']}'";		$res=mysql_query($query);		$row=mysql_fetch_array($res);		$id = $row['id'];		$title_faculty = $row['title_faculty'];		$year_of_foundation = $row['year_foundation'];		$id_decan = $row['id_decan'];				$GLOBALS['h1'] = "Редагування факультета {$row['title_faculty']}";		$GLOBALS['content'] = <<<HTML		<div class="row-fluid">			<div class="span6">				<form class="well form-inline" method="POST" action="/?action=editFacultyDo">						<div class="row-fluid">						<label>Назва факультету</label>						<input type="text" name="faculty" class="span12" value="{$title_faculty}"/>					</div>					<div class="row-fluid">						<label>Рік заснування</label>						<input type="text" name="year_foundation" class="span12" value="{$year_of_foundation}"/>					</div>					<div class="row-fluid">						<label>Декан</label>						<select name="decan" class="span12">							{$decan}						</select>					</div>					<div class="row-fluid">						<button type="submit" class="btn">Змінити</button>						<input type="hidden" name="id" value="{$id}"/>					</div>				</form>			</div>		</div>HTML;	}		function editFacultyDo(){//редагування юзера		$strSQL = 'UPDATE faculties SET title_faculty = "'.$_POST["faculty"].'", year_foundation = "'.$_POST["year_foundation"].'", id_decan = "'.$_POST["decan"].'" WHERE id = "'.$_POST['id'].'"';		mysql_query($strSQL);		header('Location: /?action=listFaculty', true, 303);	}		function subjectOfFaculty(){		$query="SELECT 					subjects.title_subject,					subjects.id_lector,					subjects.id_faculty,					faculties.id,					faculties.title_faculty,					lectors.surname,					lectors.firstname				FROM 					subjects				LEFT JOIN faculties ON subjects.id_faculty=faculties.id				LEFT JOIN lectors ON subjects.id_lector=lectors.id				WHERE subjects.id_faculty={$_GET['id']}";		$res=mysql_query($query);		$i = 0;		$GLOBALS['content'] = '';		$GLOBALS['content'] .= <<<TPL		<div class="row-fluid">			<table class="table table-bordered" id="dt_gal">				<thead>					<tr style="text-align:center;">						<th>№</th>						<th>Назва предмету</th>						<th>Лектор</th>						</tr>				</thead>			<tbody>TPL;		while($row=mysql_fetch_array($res)){			if($i==0){				$title_faculty = $row['title_faculty'];			}			$GLOBALS['h1'] = "Факультет: ".$title_faculty;			$i = $i+1;			$GLOBALS['content'] .= "				<tr>					<td>".$i."</td>					<td>".$row['title_subject']."</td>					<td>".$row['surname']." ".$row['firstname']."</td>				<tr/>";		}		$GLOBALS['content'] .= '</tbody></table></div>';	}		function lectorOfFaculty(){		$query="SELECT 					faculties.id,					faculties.title_faculty,					lectors.surname,					lectors.firstname,					lectors.id_faculty_work				FROM 					lectors				LEFT JOIN faculties ON lectors.id_faculty_work=faculties.id				WHERE lectors.id_faculty_work={$_GET['id']}";		$res=mysql_query($query);		$i = 0;		$GLOBALS['content'] = '';		$GLOBALS['content'] .= <<<TPL		<div class="row-fluid">			<table class="table table-bordered" id="dt_gal">				<thead>					<tr style="text-align:center;">						<th>№</th>						<th>Лектор</th>						</tr>				</thead>			<tbody>TPL;		while($row=mysql_fetch_array($res)){			if($i==0){				$title_faculty = $row['title_faculty'];			}			$GLOBALS['h1'] = "Факультет: ".$title_faculty;			$i = $i+1;			$GLOBALS['content'] .= "				<tr>					<td>".$i."</td>					<td>".$row['surname']." ".$row['firstname']."</td>				<tr/>";		}		$GLOBALS['content'] .= '</tbody></table></div>';	}	?>